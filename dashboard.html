<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIX EYES | SUPREME DEFENDER v8.0</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00d9ff; --bg: #020202; --panel: #0a0a0c; --java: #00ff41; --danger: #ff003c; --warn: #ffcc00; }
        body { background: var(--bg); color: var(--neon); font-family: 'JetBrains Mono', monospace; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 320px; background: var(--panel); border-right: 1px solid #1a1a1a; padding: 20px; display: flex; flex-direction: column; z-index: 10; }
        #terminal { flex: 1; background: #000; padding: 10px; font-size: 11px; color: var(--java); overflow-y: auto; border: 1px solid #111; margin: 15px 0; border-left: 2px solid var(--java); }
        
        /* Main Area */
        .main { flex: 1; padding: 25px; overflow-y: auto; position: relative; }
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; }
        .stat-card { background: var(--panel); padding: 20px; border-bottom: 3px solid var(--neon); text-align: center; }
        .stat-card label { display: block; font-size: 10px; color: #444; margin-bottom: 10px; }
        .stat-card span { font-size: 2rem; font-weight: bold; color: #fff; }

        /* Grid */
        .data-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; }
        .card { background: #0d0d0f; border: 1px solid #1a1a1a; padding: 20px; position: relative; transition: 0.3s; }
        .card.threat { border: 1px solid var(--danger); background: linear-gradient(135deg, #150000 0%, #0d0d0f 100%); }
        .card:hover { border-color: var(--neon); transform: translateY(-3px); }

        /* Buttons */
        .btn { background: none; border: 1px solid var(--neon); color: var(--neon); padding: 12px; cursor: pointer; font-weight: bold; font-family: inherit; width: 100%; margin-bottom: 10px; transition: 0.2s; }
        .btn:hover { background: var(--neon); color: #000; }
        .btn-danger { border-color: var(--danger); color: var(--danger); }
        .btn-danger:hover { background: var(--danger); color: #fff; }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #222; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h2 style="color: #fff; margin: 0;">üåÄ SIX EYES</h2>
        <p style="font-size: 10px; color: #444;">CORE SYSTEM v8.0</p>
        
        <div id="terminal"></div>

        <button class="btn" onclick="sync()">DATABASE SYNC</button>
        <button class="btn btn-danger" onclick="massPurge()">PURGE ALL BOTS</button>
        <p style="font-size: 9px; color: #333; text-align: center;">Note: If Purge fails, disable RLS in Supabase settings.</p>
    </aside>

    <main class="main">
        <div class="stats-row">
            <div class="stat-card"><label>TOTAL RECORDS</label><span id="s-total">0</span></div>
            <div class="stat-card"><label>THREATS (USA)</label><span id="s-threats" style="color: var(--danger)">0</span></div>
            <div class="stat-card"><label>INTEGRITY</label><span id="s-integrity">100%</span></div>
        </div>

        <div class="data-grid" id="display"></div>
    </main>

    <script>
        const SUPABASE_URL = 'https://kisbfmcxvcwtxfwbgexb.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_THarexbaf5WB2Cc-c6t-sg_TQJycbtz';
        const _supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const BOT_IP = '72.153.230.168';

        function log(msg, isError = false) {
            const t = document.getElementById('terminal');
            const color = isError ? 'var(--danger)' : 'var(--java)';
            t.innerHTML += `<div style="color:${color}">> [${new Date().toLocaleTimeString()}] ${msg}</div>`;
            t.scrollTop = t.scrollHeight;
        }

        async function sync() {
            log("Syncing with Supabase...");
            const { data, error } = await _supabase
                .from('telemetry')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                log("SYNC ERROR: " + error.message, true);
                return;
            }

            const threats = data.filter(n => n.ip === BOT_IP).length;
            const integrity = data.length > 0 ? Math.round(((data.length - threats) / data.length) * 100) : 100;

            document.getElementById('s-total').innerText = data.length;
            document.getElementById('s-threats').innerText = threats;
            document.getElementById('s-integrity').innerText = integrity + "%";
            document.getElementById('s-integrity').style.color = integrity < 50 ? 'var(--danger)' : 'var(--java)';

            render(data);
            log("Sync Complete. Nodes: " + data.length);
        }

        function render(nodes) {
            const d = document.getElementById('display');
            d.innerHTML = '';
            nodes.forEach(n => {
                const isBot = n.ip === BOT_IP;
                const flag = n.location.includes("United States") ? "üá∫üá∏" : (n.location.includes("Uzbekistan") ? "üá∫üáø" : "üá®üá≠");
                
                d.innerHTML += `
                    <div class="card ${isBot ? 'threat' : ''}">
                        <div style="font-size: 10px; color: ${isBot?'var(--danger)':'#444'}">
                            ${isBot ? '‚óè CRITICAL THREAT' : '‚óè STABLE NODE'}
                        </div>
                        <h3 style="margin: 10px 0; color: #fff;">${n.ip}</h3>
                        <div style="font-size: 12px; color: #bbb; margin-bottom: 15px;">
                            ${flag} ${n.location}
                        </div>
                        <div style="font-size: 10px; color: var(--neon); margin-bottom: 15px;">
                            ID: ${n.id.substring(0, 8)}... | OP: ${n.operation_id}
                        </div>
                        <button class="btn btn-danger" style="padding: 5px; font-size: 10px;" 
                                onclick="purgeSingle('${n.id}')">PURGE RECORD</button>
                    </div>`;
            });
        }

        async function purgeSingle(id) {
            log("Purging record: " + id.substring(0,8) + "...");
            const { error } = await _supabase
                .from('telemetry')
                .delete()
                .eq('id', id);

            if (error) {
                log("PURGE FAILED: " + error.message, true);
                if(error.message.includes("policy")) {
                    alert("SUPABASE XATOSI: RLS Policies o'chirishga ruxsat bermayapti. Supabase dashboarddan RLS-ni o'chiring!");
                }
            } else {
                log("Record purged successfully.");
                sync();
            }
        }

        async function massPurge() {
            if(!confirm("Barcha bot loglarini o'chirishni tasdiqlaysizmi?")) return;
            log("Executing MASS PURGE for IP: " + BOT_IP);
            
            const { error } = await _supabase
                .from('telemetry')
                .delete()
                .eq('ip', BOT_IP);

            if (error) {
                log("MASS PURGE FAILED: " + error.message, true);
            } else {
                log("All bots scrubbed from database.");
                sync();
            }
        }

        // Har 10 soniyada avtomatik yangilash
        setInterval(sync, 10000);
        window.onload = sync;
    </script>
</body>
</html>
