<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIX EYES | FIREWALL EDITION v5.5</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00d9ff; --bg: #020202; --panel: #0a0a0c; --java: #00ff41; --danger: #ff003c; --warn: #ffcc00; --sidebar-w: 300px; }
        body { background: var(--bg); color: var(--neon); font-family: 'JetBrains Mono', monospace; margin: 0; padding: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: var(--sidebar-w); background: var(--panel); border-right: 1px solid #1a1a1a; padding: 20px; display: flex; flex-direction: column; height: 100%; box-sizing: border-box; }
        .main-content { flex: 1; padding: 25px; overflow-y: auto; position: relative; }

        /* Dashboard Elements */
        .analytics-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 25px; }
        .status-box { background: #050505; border: 1px solid #111; padding: 20px; position: relative; overflow: hidden; }
        .integrity-danger { border: 2px solid var(--danger) !important; animation: alarm-pulse 1s infinite; }
        @keyframes alarm-pulse { 0% { box-shadow: inset 0 0 10px var(--danger); } 50% { box-shadow: inset 0 0 30px var(--danger); } 100% { box-shadow: inset 0 0 10px var(--danger); } }

        /* Stats Header */
        .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--panel); padding: 15px; border-left: 3px solid var(--neon); }
        .stat-card label { display: block; font-size: 9px; color: #444; text-transform: uppercase; }
        .stat-card span { font-size: 1.2rem; font-weight: bold; color: #fff; }

        /* Cards */
        .data-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .target-card { background: #0d0d0f; border: 1px solid #1a1a1a; padding: 15px; position: relative; border-radius: 4px; }
        .target-card.critical { border: 1px solid var(--danger); background: linear-gradient(135deg, #150000 0%, #0d0d0f 100%); }
        .target-card.whitelist { border: 1px solid var(--java); }

        /* Controls */
        #console { flex: 1; background: #000; font-size: 10px; color: var(--java); padding: 10px; overflow-y: auto; margin: 15px 0; border: 1px solid #111; }
        .btn { background: transparent; border: 1px solid var(--neon); color: var(--neon); padding: 10px; font-size: 10px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 10px; }
        .btn:hover { background: var(--neon); color: #000; }
        .btn-danger { border-color: var(--danger); color: var(--danger); }
        .btn-danger:hover { background: var(--danger); color: #fff; }

        .live-stream { font-size: 10px; color: #666; height: 100px; overflow-y: auto; line-height: 1.5; }
        .flag { margin-right: 5px; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h2 style="color: #fff; letter-spacing: 2px; margin:0;">üåÄ SIX EYES</h2>
        <p style="font-size: 9px; color: #444; margin-bottom: 20px;">FIREWALL ENGINE v5.5</p>
        
        <div id="console"></div>

        <button class="btn" onclick="sync()">REFRESH UPLINK</button>
        <button class="btn btn-danger" onclick="massPurge()">PURGE ALL THREATS</button>
        <button class="btn" style="border-color: #333; color: #333;" onclick="clearLogs()">CLEAR CONSOLE</button>
    </aside>

    <main class="main-content">
        <div class="analytics-grid">
            <div class="status-box">
                <label style="font-size: 10px; color: #444;">ACTIVE TRAFFIC STREAM</label>
                <div id="live-feed" class="live-stream"></div>
            </div>
            <div id="integrity-panel" class="status-box" style="text-align: center;">
                <label style="font-size: 10px; color: #444;">SYSTEM INTEGRITY</label>
                <div id="score" style="font-size: 40px; font-weight: bold; margin: 10px 0;">100%</div>
                <div id="status-text" style="font-size: 9px; letter-spacing: 2px;">SECURE</div>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-card"><label>Total Nodes</label><span id="count-total">0</span></div>
            <div class="stat-card" style="border-color: var(--danger);"><label>Threats</label><span id="count-threats">0</span></div>
            <div class="stat-card" style="border-color: var(--java);"><label>Whitelisted</label><span id="count-white">0</span></div>
            <div class="stat-card"><label>Last Sync</label><span id="count-time">--:--</span></div>
        </div>

        <div class="data-grid" id="display"></div>
    </main>

    <script>
        const SUPABASE_URL = 'https://kisbfmcxvcwtxfwbgexb.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_THarexbaf5WB2Cc-c6t-sg_TQJycbtz';
        const _supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // CONFIGURATION
        const BLACKLIST = ['72.153.230.168']; // Bot IP
        const WHITELIST = ['91.211.134.16', '94.230.231.77', '2a0c:4d00:2:8::2']; // Sizning Shvetsariya IP-laringiz

        function log(msg) {
            const c = document.getElementById('console');
            c.innerHTML += `<div>> [${new Date().toLocaleTimeString()}] ${msg}</div>`;
            c.scrollTop = c.scrollHeight;
        }

        async function sync() {
            const { data, count } = await _supabase.from('telemetry').select('*', { count: 'exact' }).order('created_at', { ascending: false });
            if(data) {
                document.getElementById('count-total').innerText = count;
                document.getElementById('count-time').innerText = new Date().toLocaleTimeString();
                updateUI(data);
                render(data);
            }
        }

        function updateUI(nodes) {
            const threats = nodes.filter(n => BLACKLIST.includes(n.ip)).length;
            const white = nodes.filter(n => WHITELIST.includes(n.ip)).length;
            const score = nodes.length > 0 ? Math.round(((nodes.length - threats) / nodes.length) * 100) : 100;

            document.getElementById('count-threats').innerText = threats;
            document.getElementById('count-white').innerText = white;
            document.getElementById('score').innerText = score + "%";

            const panel = document.getElementById('integrity-panel');
            const statusText = document.getElementById('status-text');

            if(score < 50) {
                panel.className = 'status-box integrity-danger';
                statusText.innerText = "CRITICAL: ATTACK DETECTED";
                statusText.style.color = "var(--danger)";
            } else {
                panel.className = 'status-box';
                statusText.innerText = "SYSTEM SECURE";
                statusText.style.color = "var(--java)";
            }
        }

        function render(nodes) {
            const d = document.getElementById('display');
            const f = document.getElementById('live-feed');
            d.innerHTML = '';
            
            if(nodes[0]) {
                const flag = nodes[0].location.includes("United States") ? "üá∫üá∏" : "üá®üá≠";
                f.innerHTML = `<div>[${new Date().toLocaleTimeString()}] INBOUND: ${nodes[0].ip} (${flag})</div>` + f.innerHTML;
            }

            nodes.forEach(n => {
                const isRisk = BLACKLIST.includes(n.ip);
                const isWhite = WHITELIST.includes(n.ip);
                const flag = n.location.includes("United States") ? "üá∫üá∏" : (n.location.includes("Uzbekistan") ? "üá∫üáø" : "üá®üá≠");

                d.innerHTML += `
                    <div class="target-card ${isRisk ? 'critical' : (isWhite ? 'whitelist' : '')}">
                        <div style="font-size: 9px; display:flex; justify-content:space-between;">
                            <span style="color:${isRisk?'var(--danger)':(isWhite?'var(--java)':'#444')}">
                                ‚óè ${isRisk ? 'THREAT' : (isWhite ? 'AUTHORIZED' : 'UNKNOWN')}
                            </span>
                            <span>${n.user_agent.includes("Windows") ? 'üíª' : 'üì±'}</span>
                        </div>
                        <div style="margin: 10px 0; font-weight:bold; font-size: 14px; color:#fff;">${n.ip}</div>
                        <div style="font-size: 11px; color: #777;">${flag} ${n.location}</div>
                        <div style="font-size: 9px; color: var(--neon); margin-top:5px;">OP: ${n.operation_id}</div>
                        <div style="margin-top:15px; display:flex; gap:5px;">
                            <button class="btn" style="height:25px; padding:0;" onclick="window.open('https://www.abuseipdb.com/check/${n.ip}')">WHOIS</button>
                            <button class="btn btn-danger" style="height:25px; padding:0;" onclick="purgeNode('${n.id}')">PURGE</button>
                        </div>
                    </div>`;
            });
        }

        async function massPurge() {
            if(!confirm("Barcha xavfli IP-larni o'chirishni tasdiqlaysizmi?")) return;
            log("Executing Lockdown Purge...");
            for(let ip of BLACKLIST) {
                await _supabase.from('telemetry').delete().eq('ip', ip);
            }
            log("Lockdown successful.");
            sync();
        }

        async function purgeNode(id) {
            await _supabase.from('telemetry').delete().eq('id', id);
            sync();
        }

        function clearLogs() { document.getElementById('console').innerHTML = ''; }

        setInterval(sync, 15000);
        window.onload = () => { log("Firewall initialized."); sync(); };
    </script>
</body>
</html>
