<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gojo Six Eyes | Supreme Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --neon: #00d9ff; --bg: #050505; --dark-card: #0a0a0a; --accent: #7000ff; }
        body { background-color: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; margin: 0; padding: 20px; }
        
        .grid-layout { display: grid; grid-template-columns: 300px 1fr; gap: 20px; max-width: 1400px; margin: 0 auto; }
        
        /* Sidebar Terminal */
        .terminal { background: #000; border: 1px solid #222; padding: 15px; height: 80vh; overflow-y: auto; font-size: 11px; color: #0f0; }
        .terminal-line { margin-bottom: 5px; border-left: 2px solid #0f0; padding-left: 5px; }

        /* Main Panel */
        .main-panel { display: flex; flex-direction: column; gap: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--neon); padding-bottom: 10px; }
        
        .stat-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .stat-box { background: var(--dark-card); border: 1px solid #111; padding: 15px; text-align: center; box-shadow: inset 0 0 10px rgba(0,217,255,0.05); }
        .stat-box h2 { margin: 5px 0; font-size: 2rem; }
        
        .search-area { background: var(--dark-card); padding: 20px; border: 1px solid #111; display: flex; gap: 10px; }
        input { background: #000; border: 1px solid var(--neon); color: #fff; padding: 10px; flex-grow: 1; outline: none; }
        button { background: var(--neon); color: #000; border: none; padding: 10px 25px; cursor: pointer; font-weight: bold; text-transform: uppercase; }
        button:hover { filter: brightness(1.2); box-shadow: 0 0 15px var(--neon); }
        .btn-purge { background: #ff4444; }

        .log-list { display: flex; flex-direction: column; gap: 10px; }
        .log-item { background: var(--dark-card); border-left: 4px solid var(--neon); padding: 15px; display: grid; grid-template-columns: 1fr 1fr 1fr; position: relative; }
        .log-item:hover { background: #0f0f0f; }
        .meta-label { font-size: 10px; color: #444; }
        .sys-time { position: absolute; top: 5px; right: 10px; font-size: 10px; color: #222; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1 style="margin:0;">ðŸŒ€ SIX EYES: SUPREME CONTROL</h1>
            <span id="live-clock">00:00:00.000</span>
        </div>
        <div style="text-align: right">
            <button onclick="exportData()" style="background:#fff">EXPORT DB</button>
            <button onclick="fetchLatest()" style="background:var(--accent); color:#fff">SYNC NOW</button>
        </div>
    </div>

    <div class="grid-layout" style="margin-top: 20px;">
        <aside class="terminal" id="sys-terminal">
            <div class="terminal-line">> Initializing Six Eyes Protocol...</div>
            <div class="terminal-line">> Connection established with Supabase Cluster.</div>
        </aside>

        <main class="main-panel">
            <div class="stat-bar">
                <div class="stat-box"> <p>TOTAL NODES</p> <h2 id="count-all">0</h2> </div>
                <div class="stat-box"> <p>ACTIVE ID</p> <h2 id="active-id">NONE</h2> </div>
                <div class="stat-box"> <p>LAST SEEN</p> <h2 id="last-seen" style="font-size: 1.2rem;">---</h2> </div>
            </div>

            <div class="search-area">
                <input type="text" id="target-id" placeholder="ENTER TARGET OPERATION ID (CASE SENSITIVE)">
                <button onclick="executeSearch()">SEARCH</button>
                <button class="btn-purge" onclick="executePurge()">PURGE</button>
            </div>

            <div class="log-list" id="display-area">
                </div>
        </main>
    </div>

    <script>
        const SUPABASE_URL = 'https://kisbfmcxvcwtxfwbgexb.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_THarexbaf5WB2Cc-c6t-sg_TQJycbtz';
        const _supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let sessionLogs = [];

        // Terminalga yozish funksiyasi (Java/System style)
        function logToTerminal(msg) {
            const term = document.getElementById('sys-terminal');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            term.prepend(line);
        }

        // Live Clock
        setInterval(() => {
            const now = new Date();
            document.getElementById('live-clock').innerText = now.toISOString();
        }, 50);

        async function fetchLatest() {
            logToTerminal("Executing Sync...");
            const { data, count } = await _supabase.from('telemetry').select('*', { count: 'exact' }).order('created_at', { ascending: false }).limit(10);
            
            if (data) {
                document.getElementById('count-all').innerText = count;
                document.getElementById('last-seen').innerText = data[0]?.ip || "---";
                sessionLogs = data;
                render(data);
                logToTerminal(`Database synced. ${count} records detected.`);
            }
        }

        async function executeSearch() {
            const id = document.getElementById('target-id').value;
            if(!id) return;
            logToTerminal(`Searching for ID: ${id}...`);
            const { data } = await _supabase.from('telemetry').select('*').eq('operation_id', id).order('created_at', { ascending: false });
            
            if(data && data.length > 0) {
                document.getElementById('active-id').innerText = id;
                render(data);
                logToTerminal(`Found ${data.length} matches for ${id}.`);
            } else {
                logToTerminal(`Zero results for ${id}.`);
            }
        }

        function render(items) {
            const area = document.getElementById('display-area');
            area.innerHTML = '';
            items.forEach(log => {
                area.innerHTML += `
                    <div class="log-item">
                        <span class="sys-time">${log.id}</span>
                        <div><span class="meta-label">TARGET ID</span><br>${log.operation_id}</div>
                        <div><span class="meta-label">IP_ADDR</span><br>${log.ip}</div>
                        <div><span class="meta-label">GEO_LOC</span><br>${log.location}</div>
                    </div>`;
            });
        }

        async function executePurge() {
            const id = document.getElementById('target-id').value;
            if(!id || !confirm("CRITICAL: Purge all logs?")) return;
            logToTerminal(`WARNING: Purging logs for ${id}...`);
            await _supabase.from('telemetry').delete().eq('operation_id', id);
            fetchLatest();
        }

        function exportData() {
            const csv = "data:text/csv;charset=utf-8,ID,IP,LOC\n" + sessionLogs.map(l => `${l.operation_id},${l.ip},${l.location}`).join("\n");
            window.open(encodeURI(csv));
            logToTerminal("Exporting session data to CSV.");
        }

        window.onload = fetchLatest;
        // Avtomatik yangilash (har 30 soniyada)
        setInterval(fetchLatest, 30000);
    </script>
</body>
</html>
